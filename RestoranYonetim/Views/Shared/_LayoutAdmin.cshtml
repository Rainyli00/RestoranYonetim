@using Microsoft.AspNetCore.Http
<!DOCTYPE html>
<html lang="tr" data-theme="light">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"] - Restoran Yönetim</title>

    <link rel="stylesheet" href="~/css/daisyui.css" />
    <script src="~/js/tailwindcss.js"></script>

    <link rel="stylesheet" href="~/libs/fontawesome/all.min.css" />
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <script src="~/js/chart.min.js"></script>

    <style>
        body {
            font-family: 'Outfit', sans-serif;
            background-color: #f1f5f9; /* Slate-100 */
        }

        /* Sayfa Yüklenme Animasyonu */
        .fade-in-up {
            animation: fadeInUp 0.5s cubic-bezier(0.16, 1, 0.3, 1);
        }

        @@keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Aktif Menü Tasarımı */
        .nav-item.active {
            background: linear-gradient(90deg, #3b82f6 0%, #4f46e5 100%);
            color: white;
            box-shadow: 0 10px 15px -3px rgba(59, 130, 246, 0.3);
        }

            .nav-item.active i {
                color: white !important;
            }

        /* Hover Efekti */
        .nav-item:not(.active):hover {
            background-color: #dbeafe;
            color: #4f46e5;
            transform: translateX(5px);
        }
    </style>
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        var dropdownBtn = document.querySelector('.dropdown.dropdown-end > div[role="button"]');
        if (dropdownBtn) {
            dropdownBtn.addEventListener('click', function() {
                var badge = document.querySelector('.indicator .badge-error');
                if (badge) badge.style.display = 'none';
            });
        }
    });
    </script>
</head>
<body>

    @{
        // Hangi Sayfadayız? (Menüyü boyamak için)
        var currentAction = ViewContext.RouteData.Values["action"]?.ToString();
        var currentController = ViewContext.RouteData.Values["controller"]?.ToString();
    }

    <div class="drawer lg:drawer-open">
        <input id="my-drawer-2" type="checkbox" class="drawer-toggle" />

        <div class="drawer-content flex flex-col min-h-screen transition-all duration-300">

            <div class="navbar sticky top-0 z-30 bg-white/80 backdrop-blur-md border-b border-slate-200 px-6 h-20">

                <div class="flex-1">
                    <label for="my-drawer-2" class="btn btn-square btn-ghost lg:hidden text-slate-600">
                        <i class="fa-solid fa-bars-staggered text-xl"></i>
                    </label>

                    <div class="hidden md:block ml-2">
                        <h2 class="text-xl font-bold text-slate-800 tracking-tight">@ViewData["Title"]</h2>
                    </div>
                </div>

                <div class="flex-none gap-4">
                    <!-- Panel Değiştirme (Sadece Yöneticiler için) -->
                    @if (Context.Session.GetInt32("RolId") == 2)
                    {
                        <a href="/Garson/Index" class="btn btn-sm bg-gradient-to-r from-blue-500 to-indigo-600 hover:from-blue-600 hover:to-indigo-700 text-white border-0 gap-2 shadow-lg">
                            <i class="fa-solid fa-utensils"></i>
                            Garson Paneli
                        </a>
                    }
                    
                    <!-- Bildirimler Dropdown -->
                    <div class="dropdown dropdown-end">
                        <div tabindex="0" role="button" class="btn btn-ghost btn-circle text-slate-500 relative">
                            <div class="indicator">
                                <i class="fa-regular fa-bell text-xl"></i>
                                @{
                                    var kritikStok = ViewBag.KritikStok as int? ?? 0;
                                    var kritikStokUrunler = ViewBag.KritikStokUrunler as IEnumerable<RestoranYonetim.Models.Urun>;
                                    var stoguBitenUrunSayisi = ViewBag.StoguBitenUrunSayisi as int? ?? 0;
                                    var stoguBitenUrunler = ViewBag.StoguBitenUrunler as IEnumerable<RestoranYonetim.Models.Urun>;
                                    var digerKategoriUrun = ViewBag.DigerKategorisiUrunSayisi as int? ?? 0;
                                    var azalanStokUrunler = ViewBag.AzalanStokUrunler as IEnumerable<RestoranYonetim.Models.Urun>;
                                    var azalanStokUrunSayisi = ViewBag.AzalanStokUrunSayisi as int? ?? 0;
                                    // Kritik stok bildirimi, stoğu biten ürünlerden bağımsız olarak gösterilsin
                                    var kritikStokBildirimGoster = kritikStok > 0;
                                    var stoguBitenBildirimGoster = stoguBitenUrunSayisi > 0;
                                    var azalanStokBildirimGoster = azalanStokUrunSayisi > 0;
                                    var toplamBildirim = (stoguBitenBildirimGoster ? 1 : 0) + (azalanStokBildirimGoster ? 1 : 0) + (kritikStokBildirimGoster ? 1 : 0) + (digerKategoriUrun > 0 ? 1 : 0);
                                }
                                @if (toplamBildirim > 0)
                                {
                                    <span class="badge badge-xs badge-error indicator-item animate-pulse text-[10px] font-bold">@toplamBildirim</span>
                                }
                            </div>
                        </div>
                        <div tabindex="0" class="mt-3 z-[1] card card-compact dropdown-content w-96 bg-white shadow-2xl border border-slate-100 rounded-2xl">
                            <div class="card-body">
                                <div class="flex items-center justify-between mb-3">
                                    <h3 class="font-bold text-lg text-slate-800">Bildirimler</h3>
                                    @if (toplamBildirim > 0)
                                    {
                                        <span class="badge badge-primary badge-sm">@toplamBildirim yeni</span>
                                    }
                                </div>


                                <div class="space-y-3 max-h-96 overflow-y-auto">
                                    @if (stoguBitenBildirimGoster)
                                    {
                                        <a href="/Admin/Urunler?durum=1&siralama=stok-artan" class="flex items-start gap-3 p-3 bg-rose-50 hover:bg-rose-100 rounded-xl transition-all border border-rose-200">
                                            <div class="bg-rose-500 p-2 rounded-lg">
                                                <i class="fa-solid fa-ban text-white"></i>
                                            </div>
                                            <div class="flex-1">
                                                <h4 class="font-bold text-rose-900 text-sm">Stoğu Tükenen Ürünler</h4>
                                                <p class="text-xs text-rose-700 mt-1">@stoguBitenUrunSayisi ürünün stoğu tamamen tükendi</p>
                                                <ul class="list-disc ml-4 mt-1 text-rose-700 text-xs">
                                                    @foreach (var urun in stoguBitenUrunler ?? new List<RestoranYonetim.Models.Urun>())
                                                    {
                                                        <li>@urun.UrunAdi</li>
                                                    }
                                                </ul>
                                                <span class="text-[10px] text-rose-500 mt-2 inline-block">
                                                    <i class="fa-regular fa-clock"></i> Az önce
                                                </span>
                                            </div>
                                        </a>
                                    }

                                    @if (azalanStokBildirimGoster)
                                    {
                                        <a href="/Admin/Urunler?durum=1&siralama=stok-artan" class="flex items-start gap-3 p-3 bg-amber-50 hover:bg-amber-100 rounded-xl transition-all border border-amber-200">
                                            <div class="bg-amber-500 p-2 rounded-lg">
                                                <i class="fa-solid fa-triangle-exclamation text-white"></i>
                                            </div>
                                            <div class="flex-1">
                                                <h4 class="font-bold text-amber-900 text-sm">Stoğu Azalan Ürünler</h4>
                                                <p class="text-xs text-amber-700 mt-1">@azalanStokUrunSayisi ürünün stoğu kritik seviyede</p>
                                                <ul class="list-disc ml-4 mt-1 text-amber-700 text-xs">
                                                    @foreach (var urun in azalanStokUrunler ?? new List<RestoranYonetim.Models.Urun>())
                                                    {
                                                        <li>@urun.UrunAdi (@urun.Stok adet)</li>
                                                    }
                                                </ul>
                                                <span class="text-[10px] text-amber-500 mt-2 inline-block">
                                                    <i class="fa-regular fa-clock"></i> Az önce
                                                </span>
                                            </div>
                                        </a>
                                    }

                                    @if (kritikStokBildirimGoster)
                                    {
                                        <a href="/Admin/Urunler?durum=1&siralama=stok-artan" class="flex items-start gap-3 p-3 bg-rose-50 hover:bg-rose-100 rounded-xl transition-all border border-rose-200">
                                            <div class="bg-rose-500 p-2 rounded-lg">
                                                <i class="fa-solid fa-triangle-exclamation text-white"></i>
                                            </div>
                                            <div class="flex-1">
                                                <h4 class="font-bold text-rose-900 text-sm">Kritik Stok Uyarısı!</h4>
                                                <p class="text-xs text-rose-700 mt-1">@kritikStok ürünün stoğu 10'un altına düştü</p>
                                                <ul class="list-disc ml-4 mt-1 text-rose-700 text-xs">
                                                    @foreach (var urun in kritikStokUrunler ?? new List<RestoranYonetim.Models.Urun>())
                                                    {
                                                        <li>@urun.UrunAdi (@urun.Stok adet)</li>
                                                    }
                                                </ul>
                                                <span class="text-[10px] text-rose-500 mt-2 inline-block">
                                                    <i class="fa-regular fa-clock"></i> Az önce
                                                </span>
                                            </div>
                                        </a>
                                    }

                                    @if (digerKategoriUrun > 0)
                                    {
                                        <a href="/Admin/Urunler?katId=@ViewBag.DigerKategoriId" class="flex items-start gap-3 p-3 bg-amber-50 hover:bg-amber-100 rounded-xl transition-all border border-amber-200">
                                            <div class="bg-amber-500 p-2 rounded-lg">
                                                <i class="fa-solid fa-box-open text-white"></i>
                                            </div>
                                            <div class="flex-1">
                                                <h4 class="font-bold text-amber-900 text-sm">Kategorisiz Ürünler</h4>
                                                <p class="text-xs text-amber-700 mt-1">@digerKategoriUrun ürün "Diğer" kategorisinde bekliyor</p>
                                                <span class="text-[10px] text-amber-500 mt-2 inline-block">
                                                    <i class="fa-regular fa-clock"></i> Bugün
                                                </span>
                                            </div>
                                        </a>
                                    }

                                    @if (toplamBildirim == 0)
                                    {
                                        <div class="text-center py-8">
                                            <div class="w-16 h-16 bg-emerald-100 rounded-full flex items-center justify-center mx-auto mb-3">
                                                <i class="fa-solid fa-check text-2xl text-emerald-600"></i>
                                            </div>
                                            <p class="text-sm font-medium text-slate-600">Tüm bildirimler temiz!</p>
                                            <p class="text-xs text-slate-400 mt-1">Şu anda herhangi bir uyarı yok</p>
                                        </div>
                                    }
                                </div>

                                @if (toplamBildirim > 0)
                                {
                                    <div class="mt-3 pt-3 border-t border-slate-100">
                                        <a href="/Admin/Index" class="btn btn-ghost btn-sm w-full text-indigo-600 hover:bg-indigo-50">
                                            <i class="fa-solid fa-eye"></i> Tüm Bildirimleri Görüntüle
                                        </a>
                                    </div>
                                }
                            </div>
                        </div>
                    </div>

                    <!-- Kullanıcı Profil Kutusu -->
                    <div class="flex items-center gap-3 bg-gradient-to-r from-slate-50 to-slate-100 px-4 py-2 rounded-xl border border-slate-200">
                        <div class="avatar placeholder">
                            <div class="bg-gradient-to-br from-blue-600 to-indigo-600 text-white rounded-xl w-10 shadow-lg shadow-blue-500/30">
                                <span class="text-lg font-bold">@(Context.Session.GetString("AdSoyad")?.Substring(0, 1).ToUpper() ?? "A")</span>
                            </div>
                        </div>
                        <div class="text-left hidden sm:block">
                            <div class="text-sm font-bold text-slate-700 leading-tight">@Context.Session.GetString("AdSoyad")</div>
                            <div class="text-[10px] font-bold text-blue-500 uppercase tracking-wider">
                                @if (Context.Session.GetInt32("RolId") == 2)
                                {
                                    <span>YÖNETİCİ</span>
                                }
                                else if (Context.Session.GetInt32("RolId") == 1)
                                {
                                    <span>GARSON</span>
                                }
                                else
                                {
                                    <span>PERSONEL</span>
                                }
                            </div>
                        </div>
                    </div>

                    <!-- Çıkış Butonu -->
                    <a href="/Auth/Logout" class="btn btn-ghost btn-circle text-red-500 hover:bg-red-50 hover:text-red-600 transition-all group relative" title="Çıkış Yap">
                        <i class="fa-solid fa-arrow-right-from-bracket text-xl group-hover:scale-110 transition-transform"></i>
                        <span class="absolute -bottom-8 left-1/2 -translate-x-1/2 bg-slate-800 text-white text-xs px-2 py-1 rounded opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap">
                            Çıkış Yap
                        </span>
                    </a>
                </div>
            </div>

            <main class="p-6 lg:p-10 flex-grow fade-in-up">
                @RenderBody()
            </main>

            <footer class="footer footer-center p-6 text-slate-400 text-xs font-medium">
                <aside>
                    <p>© @DateTime.Now.Year Restoran Yönetim Sistemi - Tüm Hakları Saklıdır.</p>
                </aside>
            </footer>
        </div>

        <div class="drawer-side z-40">
            <label for="my-drawer-2" aria-label="close sidebar" class="drawer-overlay"></label>
            <ul class="menu p-4 w-72 min-h-full bg-white text-base-content border-r border-slate-200 flex flex-col">

                <li class="mb-8 mt-2">
                    <a href="/Admin/Index" class="flex items-center gap-3 px-2 hover:bg-slate-50 rounded-xl transition-all cursor-pointer">
                        <div class="w-10 h-10 rounded-xl bg-gradient-to-tr from-blue-600 to-indigo-600 flex items-center justify-center text-white shadow-lg shadow-blue-500/30">
                            <i class="fa-solid fa-utensils text-lg"></i>
                        </div>
                        <div>
                            <div class="font-black text-xl text-slate-800 leading-none tracking-tight">RESTORAN</div>
                            <div class="text-[10px] font-bold text-blue-500 tracking-[0.3em] mt-1">YÖNETİM</div>
                        </div>
                    </a>
                </li>

                <div class="space-y-1">

                <li class="menu-title font-bold text-xs text-slate-400 px-4 mb-2">GENEL</li>

                <li>
                    <a href="/Admin/Index" class="nav-item @(currentAction == "Index" ? "active" : "") rounded-xl font-medium py-3 mb-1 transition-all">
                        <i class="fa-solid fa-house w-6 text-center text-slate-400"></i> Genel Bakış
                    </a>
                </li>

                <li class="menu-title font-bold text-xs text-slate-400 px-4 mt-6 mb-2">YÖNETİM</li>

                <li>
                    <a href="/Admin/Siparisler" class="nav-item @(currentAction == "Siparisler" ? "active" : "") rounded-xl font-medium py-3 mb-1 transition-all">
                        <i class="fa-solid fa-bell-concierge w-6 text-center text-slate-400"></i> Siparişler
                    </a>
                </li>
                <li>
                    <a href="/Admin/Masalar" class="nav-item @(currentAction == "Masalar" ? "active" : "") rounded-xl font-medium py-3 mb-1 transition-all">
                        <i class="fa-solid fa-chair w-6 text-center text-slate-400"></i> Masa Düzeni
                    </a>
                </li>
                <li>
                    <a href="/Admin/Kategoriler" class="nav-item @(currentAction == "Kategoriler" ? "active" : "") rounded-xl font-medium py-3 mb-1 transition-all">
                        <i class="fa-solid fa-folder w-6 text-center text-slate-400"></i> Kategoriler
                    </a>
                </li>
                <li>
                    <a href="/Admin/Urunler" class="nav-item @(currentAction == "Urunler" ? "active" : "") rounded-xl font-medium py-3 mb-1 transition-all">
                        <i class="fa-solid fa-burger w-6 text-center text-slate-400"></i> Ürünler
                    </a>
                </li>
                <li>
                    <a href="/Admin/Personel" class="nav-item @(currentAction == "Personel" ? "active" : "") rounded-xl font-medium py-3 mb-1 transition-all">
                        <i class="fa-solid fa-users-gear w-6 text-center text-slate-400"></i> Personel
                    </a>
                </li>
                <li>
                    <a href="/Admin/GeriBildirimler" class="nav-item @(currentAction == "GeriBildirimler" ? "active" : "") rounded-xl font-medium py-3 mb-1 transition-all">
                        <i class="fa-solid fa-comment-dots w-6 text-center text-slate-400"></i> Geri Bildirimler
                    </a>
                </li>

                <li class="menu-title font-bold text-xs text-slate-400 px-4 mt-6 mb-2">FİNANS</li>

                <li>
                    <a href="/Admin/Giderler" class="nav-item @(currentAction == "Giderler" ? "active" : "") rounded-xl font-medium py-3 mb-1 transition-all">
                        <i class="fa-solid fa-wallet w-6 text-center text-slate-400"></i> Giderler
                    </a>
                </li>
                <li>
                    <a href="/Admin/Rapor" class="nav-item @(currentAction == "Rapor" ? "active" : "") rounded-xl font-medium py-3 mb-1 transition-all">
                        <i class="fa-solid fa-chart-line w-6 text-center text-slate-400"></i> Raporlar
                    </a>
                </li>

                <li class="menu-title font-bold text-xs text-slate-400 px-4 mt-6 mb-2">SİSTEM</li>

                <li>
                    <a href="/Admin/Log" class="nav-item @(currentAction == "Log" ? "active" : "") rounded-xl font-medium py-3 mb-1 transition-all">
                        <i class="fa-solid fa-list-check w-6 text-center text-slate-400"></i> İşlem Logları
                    </a>
                </li>

             
        </div>

        </ul>
    </div>
    </div>

    @await RenderSectionAsync("Scripts", required: false)
</body>
</html>